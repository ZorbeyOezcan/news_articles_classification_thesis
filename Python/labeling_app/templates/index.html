<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Article Labeling App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body class="start-screen">
    <div class="start-container">
        <h1>Article Labeling Tool</h1>

        {% if already_labeled > 0 %}
        <p class="info-text">You have <strong>{{ already_labeled }}</strong> articles already labeled.</p>
        {% endif %}

        <div class="mode-selection" id="mode-selection">
            <h2>What do you want to do?</h2>
            <div class="mode-buttons">
                <button class="mode-btn active-mode" onclick="showConfig()">Label new data</button>
                <button class="mode-btn disabled-mode" disabled title="Coming soon">Clean already labelled data</button>
            </div>
        </div>

        <div class="config-panel" id="config-panel" style="display: none;">
            <h2>Configure Labeling Session</h2>

            <div class="config-section">
                <h3>How many new data points do you want to label? (per class)</h3>
                <div class="target-mode-toggle">
                    <label>
                        <input type="radio" name="target-mode" value="uniform" checked onchange="toggleTargetMode()">
                        Uniform (same for all categories)
                    </label>
                    <label>
                        <input type="radio" name="target-mode" value="personalised" onchange="toggleTargetMode()">
                        Personalised (different per category)
                    </label>
                </div>

                <div id="uniform-input" class="target-input">
                    <label for="uniform-count">Target per category:</label>
                    <input type="number" id="uniform-count" min="1" value="100" class="number-input">
                </div>

                <div id="personalised-input" class="target-input" style="display: none;">
                    {% for cat in categories %}
                    <div class="personalised-row">
                        <label>{{ cat }}:</label>
                        <input type="number" class="cat-target number-input" data-category="{{ cat }}" min="0" value="100">
                    </div>
                    {% endfor %}
                </div>
            </div>

            <div class="config-section config-checkboxes">
                <label class="checkbox-label">
                    <input type="checkbox" id="domain-balanced" checked>
                    Same distribution by domain
                </label>
                <p class="hint-text">When checked, labeled articles will mirror the domain proportions of the full dataset.</p>

                <label class="checkbox-label">
                    <input type="checkbox" id="include-skipped">
                    Include skipped articles
                </label>
                <p class="hint-text">When checked, articles previously marked as "skipped" will appear again for labeling.</p>

                <label class="checkbox-label">
                    <input type="checkbox" id="include-not-clean">
                    Include articles needing cleaning
                </label>
                <p class="hint-text">When checked, articles previously marked as "not clean" will appear again for labeling.</p>
            </div>

            <button class="start-btn" onclick="startSession()">Start Labeling</button>
        </div>
    </div>

    <script>
        function showConfig() {
            document.getElementById('config-panel').style.display = 'block';
        }

        function toggleTargetMode() {
            const mode = document.querySelector('input[name="target-mode"]:checked').value;
            document.getElementById('uniform-input').style.display = mode === 'uniform' ? 'block' : 'none';
            document.getElementById('personalised-input').style.display = mode === 'personalised' ? 'block' : 'none';
        }

        async function startSession() {
            const mode = document.querySelector('input[name="target-mode"]:checked').value;
            const domainBalanced = document.getElementById('domain-balanced').checked;
            const includeSkipped = document.getElementById('include-skipped').checked;
            const includeNotClean = document.getElementById('include-not-clean').checked;

            let config = {
                mode: mode,
                domain_balanced: domainBalanced,
                include_skipped: includeSkipped,
                include_not_clean: includeNotClean
            };

            if (mode === 'uniform') {
                const count = parseInt(document.getElementById('uniform-count').value);
                if (!count || count < 1) {
                    alert('Please enter a valid target count.');
                    return;
                }
                config.count = count;
            } else {
                const targets = {};
                document.querySelectorAll('.cat-target').forEach(input => {
                    targets[input.dataset.category] = parseInt(input.value) || 0;
                });
                config.targets = targets;
            }

            const resp = await fetch('/start-session', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(config)
            });

            if (resp.ok) {
                window.location.href = '/label';
            } else {
                alert('Failed to start session.');
            }
        }
    </script>
</body>
</html>
